version: '3.8'

services:
  # 1. Database
  mongo:
    image: mongo
    container_name: thumbnail-mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db

  # 2. Queue
  redis:
    image: redis
    container_name: thumbnail-redis
    ports:
      - "6379:6379"

#   # 3. The Backend API
#   backend:
#     build: ./backend
#     container_name: thumbnail-api
#     ports:
#       - "3001:3001"
#     environment:
#       - PORT=3001
#       - MONGO_URI=mongodb://mongo:27017/thumbnail-app
#       - REDIS_HOST=redis
#       - REDIS_PORT=6379
#       - JWT_SECRET=super_secret_key_change_me
#     depends_on:
#       - mongo
#       - redis
#     volumes:
#       # FIX: Point to the actual uploads folder inside 'backend'
#       - ./backend/uploads:/app/uploads

#   # 4. The Worker
#   worker:
#     build: ./backend
#     container_name: thumbnail-worker
#     command: npx ts-node src/worker.ts
#     environment:
#       - MONGO_URI=mongodb://mongo:27017/thumbnail-app
#       - REDIS_HOST=redis
#       - REDIS_PORT=6379
#       - JWT_SECRET=super_secret_key_change_me
#     depends_on:
#       - mongo
#       - redis
#       - backend
#     volumes:
#       # FIX: Must match the backend path exactly so worker can find the files
#       - ./backend/uploads:/app/uploads

# frontend:
#     build: ./frontend
#     container_name: thumbnail-frontend
#     ports:
#       - "3000:3000"
#     environment:
#       # Browser needs localhost to reach backend from outside docker
#       - NEXT_PUBLIC_API_URL=http://localhost:3001
#     depends_on:
#       - backend

volumes:
  mongo-data: